{% comment %}
Debug Widget for FamilyHub Integrated Timesheet
Shows purple banner for integrated mode vs orange for standalone
{% endcomment %}

{% load debug_tags %}

{% if debug %}
<!-- Purple Debug Banner for FamilyHub Integrated Mode -->
<div id="debug-widget" style="
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    z-index: 9999;
    background: linear-gradient(135deg, #764ba2 0%, #667eea 100%);
    color: white;
    padding: 8px 15px;
    font-family: 'Courier New', monospace;
    font-size: 12px;
    box-shadow: 0 2px 10px rgba(0,0,0,0.3);
    border-bottom: 2px solid rgba(255,255,255,0.3);
">
    <div style="display: flex; justify-content: space-between; align-items: center;">
        <div style="display: flex; align-items: center; gap: 10px;">
            <i class="fas fa-clock" style="font-size: 14px;"></i>
            <strong>Timesheet (FamilyHub Integrated)</strong>
            <span style="opacity: 0.8;">|</span>
            <span>FAMILYHUB_INTEGRATED Mode</span>
            <span style="opacity: 0.8;">|</span>
            <span>Port 8000</span>
            <span style="opacity: 0.8;">|</span>
            <span style="font-size: 10px; opacity: 0.7;">FamilyHub/apps/timesheet_app/templates/</span>
        </div>
        <div style="display: flex; align-items: center; gap: 10px; font-size: 10px; opacity: 0.8;">
            <span>{% now "H:i:s" %}</span>
            <span>INTEGRATED</span>
        </div>
    </div>
</div>

<!-- Add padding to body to account for fixed debug widget -->
<style>
    body { 
        padding-top: 50px !important; 
    }
    .debug-highlight { 
        background-color: rgba(118, 75, 162, 0.2); 
        padding: 2px 4px; 
        border-radius: 3px; 
    }
</style>
{% endif %}
                        <small class="text-muted d-block">{{ debug_widget.database.name }}</small>
                        <small class="text-muted d-block">{{ debug_widget.database.host }}:{{ debug_widget.database.port }}</small>
                    </div>
                </div>
                
                <!-- Environment Info -->
                <div class="col-md-3">
                    <div class="debug-section">
                        <h6><i class="fa fa-cog"></i> Environment</h6>
                        <div class="debug-item">
                            <span class="badge bg-primary">{{ debug_widget.environment.app_type }}</span>
                        </div>
                        <div class="debug-item">
                            <span class="badge bg-{% if debug_widget.environment.environment == 'Docker' %}info{% else %}secondary{% endif %}">
                                {{ debug_widget.environment.environment }}
                            </span>
                        </div>
                        <small class="text-muted d-block">Python {{ debug_widget.environment.python_version }}</small>
                    </div>
                </div>
                
                <!-- Apps Info -->
                <div class="col-md-3">
                    <div class="debug-section">
                        <h6><i class="fa fa-th"></i> Apps</h6>
                        <div class="debug-item">
                            <span class="badge bg-primary">{{ debug_widget.apps.total_apps }} Apps</span>
                        </div>
                        <div class="debug-item">
                            <span class="badge bg-{% if debug_widget.environment.is_standalone %}warning{% else %}success{% endif %}">
                                {% if debug_widget.environment.is_standalone %}Standalone{% else %}Integrated{% endif %}
                            </span>
                        </div>
                    </div>
                </div>
                
                <!-- System Info -->
                <div class="col-md-3">
                    <div class="debug-section">
                        <h6><i class="fa fa-microchip"></i> System</h6>
                        <div class="debug-item">
                            <span class="badge bg-{% if debug_widget.status == 'healthy' %}success{% else %}danger{% endif %}">
                                {{ debug_widget.status|title }}
                            </span>
                        </div>
                        <small class="text-muted d-block">{{ debug_widget.environment.django_settings|truncatechars:25 }}</small>
                        {% if debug_widget.environment.debug_mode %}
                            <small class="text-warning"><i class="fa fa-exclamation-triangle"></i> DEBUG ON</small>
                        {% endif %}
                    </div>
                </div>
            </div>
            
            {% if debug_widget.status == 'error' %}
            <div class="alert alert-danger alert-sm mt-2 mb-0">
                <small><strong>Error:</strong> {{ debug_widget.error }}</small>
            </div>
            {% endif %}
        </div>
    </div>
</div>

<style>
.debug-widget {
    position: fixed;
    top: 10px;
    right: 10px;
    z-index: 9999;
    font-size: 0.8rem;
}

.debug-toggle {
    text-align: right;
}

.debug-content {
    position: absolute;
    top: 100%;
    right: 0;
    width: 600px;
    max-width: 90vw;
    background: rgba(33, 37, 41, 0.95);
    color: white;
    border-radius: 8px;
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
    backdrop-filter: blur(10px);
    margin-top: 5px;
}

.debug-header {
    padding: 0.75rem 1rem;
    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    background: rgba(255, 255, 255, 0.1);
    border-radius: 8px 8px 0 0;
}

.debug-body {
    padding: 1rem;
}

.debug-section {
    padding: 0.5rem;
    background: rgba(255, 255, 255, 0.05);
    border-radius: 6px;
    height: 100%;
}

.debug-section h6 {
    font-size: 0.75rem;
    margin-bottom: 0.5rem;
    color: #adb5bd;
}

.debug-item {
    margin-bottom: 0.25rem;
}

.debug-widget .badge {
    font-size: 0.65rem;
    margin-right: 0.25rem;
}

.debug-widget small {
    font-size: 0.65rem;
    line-height: 1.2;
}

@media (max-width: 768px) {
    .debug-content {
        width: 350px;
    }
    
    .debug-section h6 {
        font-size: 0.7rem;
    }
    
    .debug-widget .badge {
        font-size: 0.6rem;
    }
}
</style>

<script>
function toggleDebugWidget() {
    const content = document.getElementById('debug-content');
    if (content.style.display === 'none') {
        content.style.display = 'block';
    } else {
        content.style.display = 'none';
    }
}

// Close debug widget when clicking outside
document.addEventListener('click', function(event) {
    const widget = document.getElementById('debug-widget');
    const content = document.getElementById('debug-content');
    
    if (widget && !widget.contains(event.target) && content.style.display === 'block') {
        content.style.display = 'none';
    }
});
</script>
{% endif %}
